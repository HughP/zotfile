<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ZotFile - Advanced PDF management for Zotero</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <link rel="stylesheet" href="stylesheets/github-code.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <!-- flattr -->
  <script type="text/javascript">
  /* <![CDATA[ */
      (function() {
          var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
          s.type = 'text/javascript';
          s.async = true;
          s.src = 'http://api.flattr.com/js/0.6/load.js?mode=auto';
          t.parentNode.insertBefore(s, t);
      })();
  /* ]]> */
  </script>
  <!-- twitter -->
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
  </script>
  <body>
    <div class="wrapper">
      <header>
        <h1 style="margin:0 0 10px;">ZotFile</h1>
        <h4 style="margin:0 0 25px;">Advanced PDF management for Zotero</h4>

        <p class="view">
          <h3 style="margin:0 0 0px;"><a style="font-weight:600;" href="https://addons.mozilla.org/en-US/firefox/addon/zotfile/">Download</a></h3>
          <!-- <a style="margin:0 0 55px;" href="https://addons.mozilla.org/en-US/firefox/addon/zotfile/">DOWNLOAD</a><br> -->
          <small><a href="https://github.com/jlegewie/zotfile">View the Project on GitHub</a></small>
        </p>

        <form action="https://www.paypal.com/cgi-bin/webscr" onClick="_gaq.push(['_trackEvent', 'external-links', 'donation']);" method="post">
          <input type="hidden" name="cmd" value="_s-xclick">
          <input type="hidden" name="encrypted" value="-----BEGIN PKCS7-----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-----END PKCS7-----
          ">
          &nbsp;&nbsp;&nbsp;&nbsp;<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_SM.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
          &nbsp;&nbsp;&nbsp;&nbsp;<a class="FlattrButton" style="display:none;" rev="flattr;button:compact;" href="http://www.columbia.edu/~jpl2136/zotfile.html"></a>
          <noscript><a href="http://flattr.com/thing/344324/ZotFile" target="_blank">
          <img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0" /></a></noscript>
          <img alt="" border="0" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" width="1" height="1">
          </form>

          <br><br>
          <h3 style="margin:0 0 5px;">Content</h3>
          <p class="view">
            <a class="navi" href="#features">Features <span class="navi-seperator">&#8226; </span></a>
            <a class="navi" href="#installzotfile">Install Zotfile <span class="navi-seperator">&#8226; </span></a>
            <a class="navi" href="#renamingrules">Renaming Rules <span class="navi-seperator">&#8226; </span></a>
            <a class="navi" href="#user-definedwildcards">User-Defined Wildcards <span class="navi-seperator">&#8226; </span></a>
            <a class="navi" href="#hiddenoptions">Hidden Options <span class="navi-seperator">&#8226; </span></a>
            <a class="navi" href="#reportingabug">Reporting a Bug <span class="navi-seperator">&#8226; </span></a>
            <a class="navi" href="#changelog">Changelog</a>
          </p>

          <br>
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jlegewie.com/zotfile.html" data-text="ZotFile: Advanced PDF management for Zotero">Tweet</a>

      </header>
      <section>




<h3 id="features">FEATURES</h3>

<p>Zotfile is a Zotero plugin to manage your attachments: automatically rename, move, and attach PDFs (or other files) to Zotero items, sync PDFs from your Zotero library to your (mobile) PDF reader (e.g. an iPad, Android tablet, etc.) and extract annotations from PDF files. </p>

<h4 id="★attachnewfilestozoteroitems">★ Attach New Files to Zotero Items</h4>

<p>ZotFile can rename and add the most recently modified file from the Firefox download or a user specified folder as a new attachment to the currently selected Zotero item. It renames the file using metadata from the selected Zotero item (user configurable), and stores the file as a Zotero attachment to this item (or alternatively, moves it to a custom location). </p>

<h4 id="★batchrenameandmoveattachmentsbasedonzoterometadata">★ (Batch) Rename and Move Attachments based on Zotero Metadata</h4>

<p>The user can also select any number of Zotero items and automatically rename and move all attachments of these items according to the user defined rules using metadata of the respective zotero item (batch processing). </p>

<h4 id="★syncpdfswithyouripadorandroidtablet">★ Sync PDFs with your iPad or Android tablet</h4>

<p>To read and annotate PDF attachments on your mobile device, zotfile can sync PDFs from your Zotero library to your (mobile) PDF reader (e.g. an iPad, Android tablet, etc.). Zotfile sends files to a location on your PC or Mac that syncs with your PDF reader App (PDF Expert, iAnnotate, GoodReader etc.), allows you to configure custom subfolders for easy access, and even extracts the annotations and highlighted text to Zotero notes when you get the files back from your tablet. Instructions are below. </p>

<h4 id="★extractannotationsfrompdffiles">★ Extract Annotations from PDF Files</h4>

<p>After highlighting and annotating pdfs on your tablet (or with the PDF reader application on your computer), ZotFile can automatically extract the highlighted text and note annotations from the pdf. The extracted text is saved in a Zotero note. Thanks to Joe Devietti, this feature is now available on all platforms based on the pdf.js library. </p>

<figure>
<img src="pics/pdf-annotation-full.png" alt="" />
<figcaption></figcaption></figure>

<h3 id="installzotfile">INSTALL ZOTFILE</h3>

<p>To start using zotfile, make sure that Zotero is installed and follow these simple steps: </p>

<ol>
<li><p>Install ZotFile</p>

<p>For <em>Zotero Firefox</em>, click on the the download link above and follow the instructions on the Mozilla Add-Ons page. For <em>Zotero Standalone</em>, first download the extension file (follow the download link above, click on &#8216;Continue to Download&#8217;. In Firefox, right-click &#8216;Add to Firefox&#8217; and select &#8216;Save Link As&#8217;. In other browsers, click on &#8216;Download Now&#8217; (it&#8217;s greyed out) and then &#8216;download anyway&#8217;). Now start Zotero Standalone, and go to &#8216;Tools-&gt;Add-ons-&gt;Tools for all Add-ons (the small,drop-down wheel in the top right corner)-&gt;Install Add-on From File&#8217; and pick the downloaded .xpi file. </p></li>
<li><p>Change the Source Folder for Attaching new Files</p>

<p>To attach new files to Zotero items, zotfile looks for the most recently modified (e.g. just downloaded) file in a user specified folder. For Zotero Firefox, this option is set to the Firefox download folder by default. For Zotero Standalone, this option has to be changed on the &#8216;General Settings&#8217; tab in the preference window (Zotero Actions -&gt; ZotFile Preferences). The source folder can be set to any location but I generally recommend setting it to your browser&#8217;s download folder such as ~/Downloads on the mac for most browsers. </p></li>
<li><p>Changing other Options (optional)</p>

<p>ZotFile offers many other options that can be changed by the user. Most of them are located in the zotfile preference window under Zotero Actions -&gt; ZotFile Preferences. </p></li>
</ol>

<h4 id="syncingpdfattachmentswithyouripadorandroidtablet">Syncing pdf attachments with your ipad or android tablet</h4>

<p>To read and annotate PDF attachments on your mobile device, zotfile can sync PDFs from your Zotero library to your (mobile) PDF reader (e.g. an iPad, Android tablet, etc.). For this purpose, Zotfile sends files to a location on your PC or Mac that syncs with your PDF reader App (PDF Expert, iAnnotate, GoodReader etc.), and gets them back when you have finished reading them. To get started, first set up a folder on your PC or Mac that syncs with your tablet reader application. Files that are copied to this folder should automatically appear in your PDF reader application. One possibility is Dropbox, which is free for up to 2GB of space and works with most PDF reader apps. More detailed instructions as well as alternative options should be available on the website of your PDF reader App. Second, open the &#8216;Tablet Settings&#8217; tab in the zotfile preference window and enable the option &#8216;Use ZotFile to send and get files from tablet&#8217;. Third, change the zotfile location for files on the tablet to the folder that syncs with your pdf reader app (&#8216;Base Folder&#8217; on the &#8216;Tablet Settings&#8217; tab). Forth (optional), set up subfolders that make it easy to sort your files in the tablet folder so that you can easily find them on your tablet.<br/>
You can now start sending pdfs (or other files) to your tablet. Simply right-click on a zotero item and select &#8216;Send to Tablet&#8217; under &#8216;Manage Attachments&#8217;. When you are done reading and annotating your pdf, just get the file back from the tablet by clicking on &#8216;Get from Tablet&#8217; under &#8216;Manage Attachments&#8217;. ZotFile will automatically remove the file from your tablet folder and extract the annotations from the pdf file to a zotero note. Alternatively, you can use the &#8216;Scan Tablet Files&#8217; function in Zotero&#8217;s Action Menu to automatically check whether any files in the tablet folder have changed. ZotFile then asks the user how to proceed for each modified file. </p>

<h3 id="renamingrules">RENAMING RULES</h3>

<figure>
<img src="pics/zotfile-reader-rename.jpg" alt="" />
<figcaption></figcaption></figure>

<p>ZotFile renames files based on bibliographic information from the currently selected Zotero item. You can change the renaming rules in the zotfile preference window under renaming rules (Zotero Actions -&gt; ZotFile Preferences). The option &#8216;Renaming Format&#8217; allows you to create custom renaming rules using wildcards, which are replaced by metadata from the selected Zotero item. Zotfile also supports optional and exclusive wild-cards. Optional wild-cards mean that <code>{-%y}</code> only includes the seperator <code>-</code> in the filename if <code>%y</code> is defined. Exclusive wild-cards such as <code>%s|%j</code> will generate the entry for <code>%s</code> if that exists and the entry for <code>%j</code> otherwise. Other characters between the wildcards and the bar are ignored (<code>%s | stuff %j | - more %p</code> is equivalent to <code>%s|%j|%p</code>). Some examples are below. </p>

<h4 id="wildcards">Wildcards</h4>

<ul>
<li><code>%a</code> last names of authors (not editors etc) or inventors. The maximum number of authors are changed under &#8216;Additional Settings&#8217;.</li>
<li><code>%I</code> author initials.</li>
<li><code>%F</code> author&#8217;s last name with first letter of first name (e.g. EinsteinA).</li>
<li><code>%A</code> first letter of author (useful for subfolders)</li>
<li><code>%y</code> year (extracted from Date field)</li>
<li><code>%t</code> title. Usually truncated after : . ? The maximal length of the remaining part of the title can be changed.</li>
<li><code>%T</code> item type (localized)</li>
<li><code>%j</code> name of the journal</li>
<li><code>%p</code> name of the publisher</li>
<li><code>%w</code> name of the journal, publisher, meeting name for presentation etc.</li>
<li><code>%s</code> journal abbreviation</li>
<li><code>%v</code> journal volume</li>
<li><code>%e</code> journal issue</li>
<li><code>%f</code> pages</li>
<li><code>%n</code> patent number (patent items only)</li>
<li><code>%i</code> assignee (patent items only)
<!-- - `%u` issue date (patent items only) --></li>
</ul>

<h4 id="examples">Examples</h4>

<p>Abbott, Andrew, and Alexandra Hrycak (1990): Measuring Resemblance in Sequence Data: An Optimal Matching Analysis of Musicians&#8217; Careers. American Journal of Sociology 96:144&#8211;185. </p>

<ul>
<li><p><code>{%a}{-%y}{-%j (%s)}</code> - Abbott&#8211;1990-American Journal of Sociology (AJS)</p>

<p>(if either &#8220;%j&#8221; or &#8220;%s&#8221; is empty, &#8220;Abbott&#8211;1990&#8221;) </p></li>
<li><p><code>{%a-}{%y-}{%s|%j}</code> - &#8220;Abbott&#8211;1990-AJS&#8221; or &#8220;Abbott&#8211;1990-American Journal of Sociology&#8221; if &#8220;%s&#8221; is empty </p></li>
<li><p><code>{%a_}{%y_}{%t}</code>: Abbott_Hrycak_1990_Measuring Resemblance in Sequence Data </p></li>
<li><p><code>%a-%y %t</code>: Abbott_Hrycak&#8211;1990 Measuring Resemblance in Sequence Data </p></li>
<li><p><code>{%w_}{%y_}{%a}</code>: American Journal of Sociology_1990_Abbott_Hrycak</p>

<p>With &#8216;Maximum number of authors&#8217; set to 1 and &#8216;Add suffix &#8230;&#8217; set to &#8216;et al&#8217; </p></li>
<li><p><code>%a_%y_%t</code>: Abbott et al_1990_Measuring Resemblance in Sequence Data</p>

<p>With &#8216;Maximum number of authors&#8217; set to 1, &#8216;Add suffix &#8230;&#8217; disabled, and &#8216;Maximum length of title&#8217; set to 10 </p></li>
<li><p><code>%a_%y_%t</code>: Abbott_1990_Measuring </p></li>
</ul>

<h3 id="user-definedwildcards">USER-DEFINED WILDCARDS</h3>

<p>All wildcards are now defined in the hidden preference <code>zotfile.wildcards.default</code> and can be changed by the user. But I <strong>strongly</strong> suggest that you do not change this preference. Instead, there is a second hidden preference <code>zotfile.wildcards.user</code>, which allows you to add and overwrite wildcards (hidden preference can be changed in <code>about:config</code>). This is a preference for advanced users without any error checking. Be careful what you do and validate your JSON using <a href="http://jsonlint.com">this site</a>! By default, <code>zotfile.wildcards.user</code> is set to <code>{}</code> so that no user wildcards are defined. Below is an example JSON that defines wildcards for <code>%1</code>, <code>%2</code>, <code>%3</code>, <code>%4</code>, and <code>%5</code> illustrating all the possibilities: </p>

<ol>
<li><p>String with the name of Zotero field (<code>%1</code>) </p></li>
<li><p>JSON with item type specific field names (<code>%2</code>)</p>

<p>Always include a <code>default</code> value. Otherwise this is not going to work. A list of all item types is available <a href="https://api.zotero.org/itemTypes?pprint=1">here</a>. </p></li>
<li><p>JSON with <code>field</code> element and transformations based on regular expressions (<code>%3</code> and <code>%4</code>)</p>

<p>ZotFile uses the specified <code>field</code> as an input string and then applies the transformations specified in <code>operations</code>. The value of <code>field</code> can either be the name of a Zotero field (see 1) or a javascript object with item type specific field names (see 2). <code>operations</code> is an array of javascript objects and supports three types of transformations that are identified by the <code>function</code> element:</p>

<ul>
<li><p><code>exec</code>: Search for matches using regular expressions (<code>%3</code>). Zotfile uses the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/exec">exec() function</a> based on the regular expression defined in <code>regex</code>, and returns the element specified in <code>group</code> so that <code>0</code> returns the matched text and higher values the corresponding capturing parenthesis. If the match fails, this operation returns the input data.<br>
Required parameters: <code>regex</code><br>
Optional parameters: <code>group</code> (default <code>0</code>), <code>flags</code> (default <code>&quot;g&quot;</code>)</p></li>
<li><p><code>replace</code>: Replaces matches of a pattern using regular expressions (<code>%4</code>). Zotfile uses the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace">replace() function</a> with the regular expression <code>regex</code> and replacement string <code>replacement</code>. The replacement string can include <code>$n</code> for the <em>n</em>th parenthesized sub-match string and other special replacement patterns (see <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace">replace() documentationn</a>). The wildcard <code>%4</code>, for example, takes the date when an item was added (format <code>2012-02-18 02:31:37</code>) and returns the reformatted date as <code>20120218</code>.<br>
Required parameters: <code>regex</code>, <code>replacement</code><br>
Optional parameters: <code>flags</code> (default <code>&quot;g&quot;</code>)</p></li>
<li><p><code>toLowerCase</code> etc: Simple string functions that that do not require any additional arguments(<code>%5</code>). Currently supported are <code>toLowerCase</code>, <code>toUpperCase</code>, and <code>trim</code>.</p></li>
</ul>

<p><code>flags</code> is an optional parameter for both searching and replacing and corresponds to <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions#Advanced_Searching_With_Flags">flags for regular expressions</a> in javascript (default: <code>&quot;g&quot;</code>). </p></li>
<li><p>Finally, the wildcard <code>%5</code> illustrates a complex combination of operations (completely arbitrary). </p></li>
</ol>

<h4 id="exampleforuser-definedwildcards">Example for user-defined wildcards</h4>

<pre><code class="json">{
    &quot;1&quot;: &quot;publicationTitle&quot;,
    &quot;2&quot;: {
        &quot;default&quot;: &quot;publicationTitle&quot;,
        &quot;book&quot;: &quot;publisher&quot;,
        &quot;bookSection&quot;: &quot;publisher&quot;
    },
    &quot;3&quot;: {
        &quot;field&quot;: &quot;title&quot;,
        &quot;operations&quot;: [{
            &quot;function&quot;:&quot;exec&quot;,
            &quot;regex&quot;: &quot;([\\w ,-]{1,50})[:\\.?!]?&quot;,
            &quot;group&quot;: 1
        }]
    },
    &quot;4&quot;: {
        &quot;field&quot;:&quot;dateAdded&quot;,
        &quot;operations&quot;: [{
            &quot;function&quot;: &quot;replace&quot;,
            &quot;regex&quot;: &quot;(\\d{4})-(\\d{2})-(\\d{2})(.*)&quot;,
            &quot;replacement&quot;: &quot;$1$2$3&quot;,
            &quot;flags&quot;:&quot;g&quot;
        }]
    },
    &quot;5&quot;: {
        &quot;default&quot;: {
            &quot;field&quot;: &quot;title&quot;,
            &quot;operations&quot;: [
                {
                    &quot;function&quot;:&quot;replace&quot;,
                    &quot;regex&quot;: &quot;\\d&quot;,
                    &quot;replacement&quot;: &quot;&quot;
                },
                {
                    &quot;function&quot;: &quot;exec&quot;,
                    &quot;regex&quot;: &quot;([\\w ,-]{1,10})[:\\.?!]?&quot;,
                    &quot;group&quot;: 1
                },
                {
                    &quot;function&quot;: &quot;toUpperCase&quot;
                },
                {
                    &quot;function&quot;: &quot;trim&quot;
                }
            ]
        },
        &quot;journalArticle&quot;: &quot;publicationTitle&quot;
    }
}</code></pre>

<h4 id="itemtypesandfieldnames">Item types and field names</h4>

<p>A complete list of Zotero fields is available <a href="https://api.zotero.org/itemFields?pprint=1">here</a> (<code>dateModified</code> and <code>dateAdded</code> seem to be missing from that list) and all the item types are <a href="https://api.zotero.org/itemTypes?pprint=1">here</a>. The fields for each item type are listed on <a href="http://aurimasv.github.io/z2csl/typeMap.xml">this page</a>. Zotfile defines a number of <em>additional fields</em> that can be used as part of wildcards: <code>itemType</code> is the language specific item type, <code>formatedTitle</code> is the title formatted using the options defined in the zofile preferences, <code>author</code> is the author string formatted using the zotfile preferences, <code>authorLastF</code> is the author string formatted as LastnameF, and <code>authorInitials</code> are the initial of the authors. </p>

<h4 id="formattingrules">Formatting rules</h4>

<p>There are a couple of formatting rules for the user-defined wildcards: </p>

<ul>
<li>Wildcards can only be one character</li>
<li>Use double escape characters in regular expression so that a <code>\d</code> becomes <code>\\d</code></li>
<li>Always use <code>&quot;</code> never <code>'</code></li>
</ul>

<p>Most importantly, <a href="http://jsonlint.com">validate your json</a>. Check out <code>zotfile.wildcards.default</code> for more examples (see below). Finally, the JSON has to be reformatted to one line that can be pasted into the preference field in <code>about:config</code>. Here is the example from above: </p>

<p><code>{&quot;1&quot;: &quot;publicationTitle&quot;, &quot;2&quot;: {&quot;default&quot;: &quot;publicationTitle&quot;, &quot;book&quot;: &quot;publisher&quot;, &quot;bookSection&quot;: &quot;publisher&quot;}, &quot;3&quot;: {&quot;field&quot;: &quot;title&quot;, &quot;operations&quot;: [{&quot;function&quot;:&quot;exec&quot;, &quot;regex&quot;: &quot;([\\w ,-]{1,50})[:\\.?!]?&quot;, &quot;group&quot;: 1 }] }, &quot;4&quot;: {&quot;field&quot;:&quot;dateAdded&quot;, &quot;operations&quot;: [{&quot;function&quot;: &quot;replace&quot;, &quot;regex&quot;: &quot;(\\d{4})-(\\d{2})-(\\d{2})(.*)&quot;, &quot;replacement&quot;: &quot;$1$2$3&quot;, &quot;flags&quot;:&quot;g&quot;}] }, &quot;5&quot;: {&quot;default&quot;: {&quot;field&quot;: &quot;title&quot;, &quot;operations&quot;: [{&quot;function&quot;:&quot;replace&quot;, &quot;regex&quot;: &quot;\\d&quot;, &quot;replacement&quot;: &quot;&quot;}, {&quot;function&quot;: &quot;exec&quot;, &quot;regex&quot;: &quot;([\\w ,-]{1,10})[:\\.?!]?&quot;, &quot;group&quot;: 1 }, {&quot;function&quot;: &quot;toUpperCase&quot;}, {&quot;function&quot;: &quot;trim&quot;} ] }, &quot;journalArticle&quot;: &quot;publicationTitle&quot;} }</code> </p>

<p>You can use a javascript console such as Firefox&#8217;s Scratchpad to test whether the JSON is properly formatted:</p>

<pre><code class="javascript">wildcard = &apos;{&quot;1&quot;: &quot;publicationTitle&quot;}&apos;;
JSON.parse(wildcard)</code></pre>

<h4 id="defaultsettingofzotfile.wildcards.default">Default setting of <code>zotfile.wildcards.default</code></h4>

<p>Note that the information here might not be up to date. As a formated JSON:</p>

<pre><code class="json">{
    &quot;a&quot;: &quot;author&quot;,
    &quot;A&quot;: {
        &quot;field&quot;: &quot;author&quot;,
        &quot;operations&quot;:[{
            &quot;function&quot;: &quot;exec&quot;,
            &quot;regex&quot;: &quot;\\w{1}&quot;
        },
        {
            &quot;function&quot;:&quot;toUpperCase&quot;
        }]
    },
    &quot;F&quot;: &quot;authorLastF&quot;,
    &quot;I&quot;: &quot;authorInitials&quot;,
    &quot;t&quot;: &quot;titleFormated&quot;,
    &quot;h&quot;: &quot;shortTitle&quot;,
    &quot;j&quot;: &quot;publicationTitle&quot;,
    &quot;s&quot;: &quot;journalAbbreviation&quot;,
    &quot;p&quot;: &quot;publisher&quot;,
    &quot;w&quot;: {
        &quot;default&quot;: &quot;publisher&quot;,
        &quot;audioRecording&quot;: &quot;label&quot;,
        &quot;bill&quot;: &quot;legislativeBody&quot;,
        &quot;case&quot;: &quot;court&quot;,
        &quot;computerProgram&quot;: &quot;company&quot;,
        &quot;film&quot;: &quot;distributor&quot;,
        &quot;journalArticle&quot;: &quot;publicationTitle&quot;,
        &quot;magazineArticle&quot;: &quot;publicationTitle&quot;,
        &quot;newspaperArticle&quot;: &quot;publicationTitle&quot;,
        &quot;patent&quot;: &quot;issuingAuthority&quot;,
        &quot;presentation&quot;: &quot;meetingName&quot;,
        &quot;radioBroadcast&quot;: &quot;network&quot;,
        &quot;report&quot;: &quot;institution&quot;,
        &quot;thesis&quot;: &quot;university&quot;,
        &quot;tvBroadcast&quot;: &quot;network&quot;
    },
    &quot;n&quot;: &quot;patentNumber&quot;,
    &quot;i&quot;: &quot;assignee&quot;,
    &quot;y&quot;: {
        &quot;field&quot;: {
            &quot;default&quot;: &quot;date&quot;,
            &quot;patent&quot;: &quot;issueDate&quot;
        },
        &quot;operations&quot;:[{
            &quot;function&quot;: &quot;exec&quot;,
            &quot;regex&quot;: &quot;\\\\d{4}&quot;
        }]
    },
    &quot;v&quot;: &quot;volume&quot;,
    &quot;e&quot;: &quot;issue&quot;,
    &quot;T&quot;: &quot;itemType&quot;,
    &quot;f&quot;: &quot;pages&quot;,
    &quot;x&quot;: &quot;extra&quot;
}</code></pre>

<p>In one line so that you can copy it to <code>zotfile.wildcards.default</code> if you screw up: </p>

<p><code>{&quot;a&quot;: &quot;author&quot;, &quot;A&quot;: {&quot;field&quot;: &quot;author&quot;, &quot;operations&quot;:[{&quot;function&quot;:&quot;exec&quot;,&quot;regex&quot;: &quot;\\w{1}&quot;},{&quot;function&quot;:&quot;toUpperCase&quot;}]}, &quot;F&quot;: &quot;authorLastF&quot;, &quot;I&quot;: &quot;authorInitials&quot;, &quot;t&quot;: &quot;titleFormated&quot;, &quot;h&quot;: &quot;shortTitle&quot;, &quot;j&quot;: &quot;publicationTitle&quot;, &quot;s&quot;: &quot;journalAbbreviation&quot;, &quot;p&quot;: &quot;publisher&quot;, &quot;w&quot;: {&quot;default&quot;: &quot;publisher&quot;, &quot;audioRecording&quot;: &quot;label&quot;, &quot;bill&quot;: &quot;legislativeBody&quot;, &quot;case&quot;: &quot;court&quot;, &quot;computerProgram&quot;: &quot;company&quot;, &quot;film&quot;: &quot;distributor&quot;, &quot;journalArticle&quot;: &quot;publicationTitle&quot;, &quot;magazineArticle&quot;: &quot;publicationTitle&quot;, &quot;newspaperArticle&quot;: &quot;publicationTitle&quot;, &quot;patent&quot;: &quot;issuingAuthority&quot;, &quot;presentation&quot;: &quot;meetingName&quot;, &quot;radioBroadcast&quot;: &quot;network&quot;, &quot;report&quot;: &quot;institution&quot;, &quot;thesis&quot;: &quot;university&quot;, &quot;tvBroadcast&quot;: &quot;network&quot;}, &quot;n&quot;: &quot;patentNumber&quot;, &quot;i&quot;: &quot;assignee&quot;, &quot;y&quot;: {&quot;field&quot;: {&quot;default&quot;: &quot;date&quot;, &quot;patent&quot;: &quot;issueDate&quot;}, &quot;operations&quot;:[{&quot;function&quot;:&quot;exec&quot;,&quot;regex&quot;: &quot;\\d{4}&quot;}]}, &quot;v&quot;: &quot;volume&quot;, &quot;e&quot;: &quot;issue&quot;, &quot;T&quot;: &quot;itemType&quot;, &quot;f&quot;: &quot;pages&quot;, &quot;x&quot;: &quot;extra&quot;}</code> </p>

<h3 id="hiddenoptions">HIDDEN OPTIONS</h3>

<p>Zotfile has a number of hidden options that allow you to further configure zotfile. You can access the hidden options through about:config. In Zotero Firefox, type <code>about:config</code> in the url bar. In Zotero Standalone, go to Actions-&gt;Preferences-&gt;Advanced-&gt;Open <code>about:config</code>. </p>

<p>Search for <code>extensions.zotfile</code> to see a list of the hidden zotfile options. Here is a list of the options that can be changed by the user (I strongly discourage to change any of the other options): </p>

<ul>
<li><p><code>.allFiles</code></p>

<p>By default, zotfile&#8217;s &#8216;Attach New File&#8217; function attaches the most recently modified file from the user defined folder. With this option set to true, zotfile attaches all files in the user defined folder to the currently selected zotero item. (Note: I haven&#8217;t tested this for a while but it should still work) </p></li>
<li><p><code>.disable_renaming</code></p>

<p>Disable any renaming of files - just moves them to the specified location. </p></li>
<li><p><code>.tablet.mode</code></p>

<p>In <em>background mode</em> (mode=1, default), zotfile leaves zotero attachments at their current location and moves a copy of the file to the tablet folder (set in the zotfile preference window) when they are send to the tablet. Getting the file back from the tablet replaces the zotero attachment file and removes it from the tablet folder. This mode is recommended when you sync attachment files in your zotero library across multiple computers or when you index your attachments.</p>

<p>The <em>foreground mode</em> (mode=2) moves the attachment file to the tablet folder and links to this location from zotero. In this mode there is always only one copy of the file. You can not, however, sync linked attachments to the zotero server. </p></li>
<li><p><code>.confirmRepush</code></p>

<p>By default, zotfile asks the user whether an attachment should be send to the tablet that is already on the tablet, which can be useful to move it to a different subfolder. This user confirmation can be disabled with this option. </p></li>
<li><p><code>.tablet.tagParentPush</code>, <code>.tablet.tagParentPush_tag</code>, <code>.tablet.tagParentPull</code>, <code>.tablet.tagParentPull_tag</code></p>

<p>These options allow the user to tag the parent item when sending (push) or getting back (pull) attachments to or from the tablet. </p></li>
<li><p><code>.pdfExtraction.NoteHtmlTagStart</code>, <code>.pdfExtraction.NoteHtmlTagEnd</code>, <code>.pdfExtraction.HighlightHtmlTagStart</code>, <code>.pdfExtraction.HighlightHtmlTagEnd</code>, <code>.pdfExtraction.UnderlineHtmlTagStart</code>, <code>.pdfExtraction.UnderlineHtmlTagEnd</code></p>

<p>These options allow the user to fine-tune the formatting of the extracted PDF annotations in the zotero note. They define the opening and closing html tag for different types of annotations. The default settings format highlighted text from the pdf normally, note text in italics (&lt;i&gt; for start and &lt;/i&gt; for end), and underline underlined text (&lt;u&gt; for start and &lt;/u&gt; for end). The end options for note, highlight and underline have to be the closing tag for the corresponding start option. </p></li>
<li><p><code>.pdfExtraction.NoteRemoveHyphens</code></p>

<p>By default, zotfile removes hyphens from extracted text. Setting NoteRemoveHyphens to false, disables this option. </p></li>
<li><p><code>.UsePDFJSandPoppler</code></p>

<p>With this option, zotfile extracts PDF annotations twice using both pdf.js and poppler. This option only works on Mac OS when the poppler based extraction script is installed. </p></li>
</ul>

<h3 id="reportingabug">REPORTING A BUG</h3>

<p>You can report bugs on the <a href="http://forums.zotero.org/discussion/5301/6/zotfile-zotero-plugin-to-rename-move-and-attach-pdfs-send-them-to-ipad-extract-pdf-annotations/">Zotfile thread</a> in the Zotero forum. Please provide information about about your system (Windows, Mac OS, Linux etc) as well as your Zotfile, Zotero and Firefox version. Also make sure that you can reproduce the bug and describe the steps as closely as possible. In addition, any information from the Error Console are very helpful. You can check the Error Console in Zotero for Firefox by going to &#8216;Tools-&gt;Web Dev.-&gt;Error Console&#8217; in Firefox and look for any zotfile related stuff after the bug occurred. For zotfile bugs, the &#8216;Source File&#8217; should be something like <code>chrome://zotfile/content/...</code> (most likely zotfile.js). You can also clear the console, execute the actions that caused the problem and then check again. If I ask you to provide a Report ID, follow the instructions <a href="http://www.zotero.org/support/reporting_bugs">here</a>. </p>

<h3 id="changelog">CHANGELOG</h3>

<h4 id="changesin3.1">Changes in 3.1</h4>

<ul>
<li>New zotfile webpage at <a href="http://www.zotfile.com/">www.zotfile.com</a> (please update links)</li>
<li>User-defined wildcards (<a href="#user-definedwildcards">documentation</a>)</li>
<li>watch folder now adds an attachment and retrieves metadata if no file is selected<br/>
 (change message, change version)</li>
<li>fix pdf.js issue with some pdf annotation (see <a href="https://forums.zotero.org/discussion/31903/extract-pdf-annotations-message-hangs-on-linuxubuntu/#Comment_177201">this</a> discussion)</li>
<li>The <code>%w</code> wildcard now maps to the correct field for most item types</li>
<li>The <code>%u</code> wildcard was removed (use <code>%y</code> instead)</li>
<li>Choose the number of authors to display when truncating authors during renaming (thanks to bwiernik)</li>
<li>fix problem that small info window does not disappear</li>
<li>fix <code>TypeError: f.exists</code> error</li>
</ul>

<h4 id="changesin3.0.3">Changes in 3.0.3</h4>

<ul>
<li>fix for issue with showing website on every restart</li>
<li>fix for issue when adding new attachment</li>
</ul>

<p>Other small fixes mainly for Italian translation, restriction of saved searches and renaming based on collections. </p>

<h4 id="changesin3.0">Changes in 3.0</h4>

<ul>
<li><p><strong>Improved extraction of annotation</strong></p>

<p>The extraction of pdf annotations using pdf.js works much better now! Zotfile uses a modified version of the updated <a href="https://github.com/mozilla/pdf.js">pdf.js</a> library (<a href="https://github.com/jlegewie/pdf.js">here</a> is the fork). The new version supports more pdf standards, detects spaces more precisely, sorts annotations in the correct order, and future updates to new versions of pdf.js are relatively easy. There are still pdfs that won&#8217;t work though! Some pdf standards are not yet supported and if you can not copy &amp; paste text from the pdf file using your pdf viewer (e.g. Preview), it&#8217;s unlikely that zotfile can help. </p></li>
<li><p><strong>Goto annotation in pdf</strong></p>

<p>The extracted annotations now include a link that opens the pdf file on the corresponding page. For the extracted annotation <code>&quot;This is my text&quot; (zotfile 2013: 4)</code>, <code>zotfile 2013: 4</code> is a link that opens the pdf on the page with the annotation. Currently, this feature only works from reports (right-click on item and select <code>generate report</code>) but future version of Zotero might be able to open the links directly from the note (see discussion <a href="https://forums.zotero.org/discussion/15186/clickable-links-in-notes/">here</a> and <a href="https://forums.zotero.org/discussion/25832/note-hyperlinks-in-standalone/">here</a>) </p></li>
<li><p><strong>Tablet feature: Restrict saved search for tablet files to sub-folders</strong></p>

<p>You can now right-click on the two saved searches for tablet files and restrict them to one of your custom sub-folders. This is very helpful to quickly see the files that are in a specific sub-folder. </p></li>
<li><p><strong>Tablet feature: Support of colored tags in Zotero 4</strong></p>

<p>Zotfile now tags the parent item when an attachment is send to the tablet so that you can easily see which items are on the tablet. Simply assign colors to the two tablet tags (<code>_tablet</code> and <code>_tablet_modified</code>). But DO NOT manually add the tag to items or attachments (also not using the keys for colored tags).
<!-- The new version includes two major changes that allow you to work with colored tags. First, zotfile now also tags the parent item when an attachment is send to the tablet. As a result, you can easily see which items are on the tablet and also which items have been modified. Second, using the keys associated with colored tags, you can now send attachments to the tablet and get them back with a simple keystroke. Note that the two tablet tags (`_tablet` and `_tablet_modified`) behave like one tag for key presses: pressing the key for either of the two tags *always* sends attachments to the tablet or gets them back. An attachment, for example, might only have the `_tablet_modified` tag because it was modified but pressing the key for the tablet tag `_tablet` still removes the attachment from the tablet and therefore *does not* assign the `_tablet` tag. To use these features, simply assign colors to the two tablet tags (`_tablet` and `_tablet_modified`). --> </p></li>
<li><p>Italian localization (thanks to Roberto Caviglia) </p></li>
<li><p>Remove empty sub-folders when getting files from tablet </p></li>
<li><p>Fix alert window (headline was missing in Zotero 4) </p></li>
<li><p>Fix automatic renaming option &#8220;Only ask if&#8230;&#8221; </p></li>
<li><p>Fix for zotfile item menu on Zotero as a tab </p></li>
</ul>

<h4 id="changesin2.3.4">Changes in 2.3.4</h4>

<ul>
<li>compatible with Zotero 4.0</li>
<li>Annotation extraction compatible with FF 20</li>
</ul>

<h4 id="changesin2.3.1">Changes in 2.3.1</h4>

<ul>
<li>adding attachments from watched folder now works when child item is selected</li>
<li>language improvements for French and German</li>
<li>bug fix for subfolders based on wildcards</li>
</ul>

<h4 id="changesin2.3">Changes in 2.3</h4>

<ul>
<li><p><strong>enhanced renaming rules</strong> (thanks to <a href="https://github.com/Midnighter">Midnighter</a>)</p>

<p>1) Optional wild-cards: <code>{-%y}</code> only includes <code>-</code> if <code>%y</code> is defined.</p>

<p>2) Exclusive wild-cards: <code>%s|%j</code> journal abbr. or if not defined full journal name.</p>

<p>(for examples see below) </p></li>
<li><p>additional wild-cards for author formating (author initials <code>%I</code> and lastnameF <code>%F</code>), pages (<code>%f</code>) and short title (<code>%h</code>) </p></li>
<li><p><strong>watch source folder for new files</strong></p>

<p>Whenever the focus changes to the item list in Zotero, Zotfile checks for new files in the source folder. If a new file was added to the folder, zotfile uses a clickable, non-disruptive window to ask the user whether s/he wants to attach that file to the currently selected Zotero item. </p></li>
<li><p><strong>revised auto rename with additional options</strong></p>

<p>Four options: Never, Always ask, Only ask if item has other atts, Always rename. The &#8216;asking&#8217; uses a clickable, non-disruptive window that appears in the bottom right corner - same as previous info window but clickable. </p></li>
<li><p><strong>revised notifications and error handling</strong> </p></li>
<li><p><strong>Zotfile translation to German</strong> (thanks to <a href="https://github.com/wuffi">wuffi</a>) <strong>and French</strong> (thanks to <a href="https://github.com/gracile-fr">gracile-fr</a>) </p></li>
<li><p>Allow periods as delimiter in filenames (thanks to <a href="https://github.com/jjatria">jjatria</a>) </p></li>
<li><p>new option: &#8220;lower case&#8221; filenames (thanks to <a href="https://github.com/jjatria">jjatria</a>) </p></li>
<li><p>new option: disable renaming so that attachments are only moved (hidden: <code>.disable_renaming</code>) </p></li>
<li><p>new option: set opening and closing quotation mark for extracted annotations (hidden: <code>.openingQuotationMarks</code>, <code>.closingQuotationMarks</code>) </p></li>
<li><p>new option: remove periods from filenames (hidden: <code>removePeriods</code>) </p></li>
<li><p>bug fix: download of poppler tool was broken </p></li>
<li><p>bug fix: preview of renaming rules for Unix and Windows </p></li>
<li><p>bug fix: sending to and getting from tablet deleted note content </p></li>
</ul>

<p><strong>Examples for enhanced renaming rules</strong><br/>
<code>%j</code> - journal; <code>%s</code> - journal abbreviation </p>

<p><code>{%a}{-%y}{-%j (%s)}</code> - <code>author-2001-Proceedings of the National Academy of Sciences (PNAS)</code><br/>
(if either <code>%j</code> or <code>%s</code> is empty, <code>author-2001</code>) </p>

<p><code>{%a-}{%y-}{%s|%j}</code> - <code>author-2001-PNAS</code> or <code>author-2001-Proceedings...</code> if <code>%s</code> is empty </p>

<p>For full description, see <a href="#renamingrules">renaming rules</a>. </p>

<h4 id="changesin2.2.3">Changes in 2.2.3</h4>

<ul>
<li>bug fix: check whether selected attachments are valid (no top-level item, no web attachments and attachment exists)</li>
<li>bug fix: editing custom folder created error if user had maximum number of custom folders</li>
</ul>

<h4 id="changesin2.2.2">Changes in 2.2.2</h4>

<ul>
<li>Add option to change delimiter between multiple authors (thanks to <a href="https://github.com/gracile-fr">gracile-fr</a>)</li>
</ul>

<h4 id="changesin2.2">Changes in 2.2</h4>

<ul>
<li>New feature: automatic renaming of attachment files (thanks to <a href="www.rtwilson.com/academic">Robin Wilson</a>)</li>
<li>Bug fix: zotfile produced error when trying to move open files on Windows (thanks to Dominik)</li>
</ul>

<h4 id="changesin2.1">Changes in 2.1</h4>

<ul>
<li>Important: the tag for tablet files was changed from &#8216;_READ&#8217; to &#8216;_tablet&#8217;</li>
<li>New saved search for modified files on tablet<br/>
 (updates automatically, replaces &#8216;Scan Tablet Files&#8217; function, which has been removed)</li>
<li>Zotfile menu items only appear for bibliographic items and attachments (not for notes)</li>
<li>Bug fix: allow the extraction of annotations in group libraries</li>
<li>Other bug fixes</li>
</ul>

<h4 id="changesin2.0">Changes in 2.0</h4>

<ul>
<li>Sync Zotero Attachments with your iPad or Android tablet</li>
<li>Extract Annotations from PDF Files (thanks to Joe Devietti)</li>
<li>redesigned preference pane</li>
<li>many more features and bug fixes</li>
</ul>



<!-- FOOTER -->
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/jlegewie">jlegewie</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <!-- google analytics tracking code -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-22825629-1', 'columbia.edu');
      ga('send', 'pageview');

    </script>
    <!-- code highlighting -->
    <script type="text/javascript" src="javascripts/highlight.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>